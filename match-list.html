<style>
    /* তোমার পছন্দের সেই সুন্দর কার্ড ডিজাইন */
    #matchCard { 
      border-radius: 1.3rem; 
      border-left: 6px solid #10b981;
      background: linear-gradient(to bottom right, #1e293b, #0f172a);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .es-value { font-weight: 800; color: #4ade80; }
    .match-title { text-shadow: 0 2px 12px #08080866; }
</style>

<main class="max-w-md mx-auto px-3 py-4">
    <div id="matchContainer" class="space-y-4">
        <p class="text-center text-gray-400 mt-10 animate-pulse">Loading matches...</p>
    </div>
</main>

<script type="module">
    import { collection, onSnapshot } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    (function() {
        const container = document.getElementById('matchContainer');
        
        // 1. Get the category ID saved from the Home Page click
        const categoryId = localStorage.getItem('currentCat');

        // Check if category is missing
        if (!categoryId) {
            container.innerHTML = `
                <div class="text-center mt-10">
                    <p class="text-red-400 font-bold text-lg">No Category Selected!</p>
                    <p class="text-gray-500 text-sm">Please go back to Home and select a game type.</p>
                </div>`;
            return;
        }

        // 2. Connect to Firebase 'allMatches' collection
        const q = collection(window.db, "allMatches");

        onSnapshot(q, (snapshot) => {
            if (!document.getElementById('matchContainer')) return;
            
            let htmlContent = '';
            let count = 0;

            snapshot.forEach((doc) => {
                const match = doc.data();
                
                // 3. Robust Filtering:
                // We check if match.category exists, then compare it with the localStorage category
                // We use toLowerCase() and trim() to ensure 'soloc' matches 'SoloC' or ' soloc '
                if (match.category && match.category.toString().toLowerCase().trim() === categoryId.toLowerCase().trim()) {
                    count++;
                    
                    // Format Time (Handle missing formatter gracefully)
                    const matchDisplayTime = window.formatMatchTime ? window.formatMatchTime(match.time) : (match.time || "TBA");
                    
                    // 4. Generate Card HTML
                    htmlContent += `
                        <div id="matchCard" class="relative overflow-hidden fade-in-up">
                          <div class="flex items-center gap-3">
                            <img src="${match.image || 'https://i.postimg.cc/rsf7yB1M/1768308154801.jpg'}" 
                                 class="rounded-lg object-cover w-16 h-16 border-2 border-emerald-800 shadow" 
                                 alt="Match Image"/>
                            <div class="match-title text-gray-100 text-lg font-bold">${match.title || 'Tournament'}</div>
                          </div>
                          
                          <div class="mt-4 space-y-1.5 text-sm">
                            <div class="flex justify-between text-gray-400"><span>Entry Fee:</span><span class="es-value">₹${match.entry || 0}</span></div>
                            <div class="flex justify-between text-gray-400"><span>Prize:</span><span class="es-value">₹${match.prize || 0}</span></div>
                            <div class="flex justify-between text-gray-400"><span>Time:</span><span class="es-value">${matchDisplayTime}</span></div>
                            <div class="flex justify-between text-gray-400"><span>Map:</span><span class="es-value">${match.map || 'Bermuda'}</span></div>
                            <div class="flex justify-between text-gray-400"><span>Slots Left:</span><span class="es-value text-red-400">${match.slot || 0}</span></div>
                          </div>

                          <button onclick="localStorage.setItem('matchId', '${doc.id}'); router.navigate('match-details')" 
                            class="mt-4 bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold py-3 rounded-xl w-full shadow-lg transition-all active:scale-95 uppercase text-sm hover:shadow-emerald-900/50">
                            Match Details
                          </button>
                        </div>`;
                }
            });

            // 5. Update the UI
            if (count === 0) {
                container.innerHTML = `
                    <div class="text-center mt-20">
                        <p class="text-gray-500 italic font-bold">No matches found for <span class="text-emerald-400">${categoryId}</span>!</p>
                    </div>`;
            } else {
                container.innerHTML = htmlContent;
            }
        });
    })();
</script>
