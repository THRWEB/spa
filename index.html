<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>FFTH - Emerald & Gold Edition</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet" />
  
  <style>
    /* --- CSS VARIABLES --- */
    :root {
        --bg-dark: #05070a;       
        --accent-grad: linear-gradient(135deg, #fbbf24, #d97706); 
        --emerald-glow: rgba(16, 185, 129, 0.4);
        --nav-bg: rgba(15, 23, 42, 0.9);
        --active-color: #10b981; 
        --header-h: 65px;         
        --nav-h: 70px;            
    }

    /* --- UNIVERSAL RESET --- */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    html, body { 
        background-color: var(--bg-dark) !important; 
        color: #f8fafc;
        font-family: 'Poppins', sans-serif;
        height: 100%;
        width: 100vw;
        overflow-x: hidden;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }

    body::-webkit-scrollbar { display: none; }

    /* --- MODERN HEADER DESIGN --- */
    header {
        position: fixed;
        top: 0; left: 0; width: 100%;
        height: var(--header-h);
        background: rgba(5, 7, 10, 0.95);
        backdrop-filter: blur(25px) saturate(180%);
        -webkit-backdrop-filter: blur(25px) saturate(180%);
        border-bottom: 1px solid rgba(16, 185, 129, 0.3);
        box-shadow: 
            0 8px 32px rgba(0, 0, 0, 0.4),
            0 0 0 1px rgba(16, 185, 129, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        z-index: 10000;
        display: flex; 
        align-items: center;
        padding: 0 16px;
    }

    .header-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
    }

    /* Left Side: Logo & Avatar */
    .logo-section {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .profile-avatar {
        position: relative;
        width: 38px;
        height: 38px;
        border-radius: 12px;
        border: 2px solid rgba(16, 185, 129, 0.6);
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
    }

    .profile-avatar::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #10b981, #fbbf24, #10b981);
        border-radius: 14px;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .profile-avatar:hover::before {
        opacity: 1;
    }

    .logo-text {
        font-size: clamp(18px, 4vw, 22px);
        font-weight: 900;
        background: linear-gradient(135deg, #fbbf24, #f59e0b, #10b981);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.02em;
        text-shadow: 0 2px 10px rgba(251, 191, 36, 0.3);
        position: relative;
    }

    .logo-text::after {
        content: '';
        position: absolute;
        bottom: -4px;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent, rgba(16, 185, 129, 0.8), transparent);
        border-radius: 1px;
    }

    /* Right Side: Actions (Notif + Wallet) */
    .header-actions {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    /* Notification Bell Styles */
    .notif-btn {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .notif-btn:active { transform: scale(0.95); }
    
    .notif-icon {
        width: 20px;
        height: 20px;
        filter: invert(1) opacity(0.8);
    }

    .notif-dot {
        position: absolute;
        top: 8px;
        right: 9px;
        width: 6px;
        height: 6px;
        background-color: #ef4444;
        border-radius: 50%;
        box-shadow: 0 0 5px #ef4444;
        animation: pulse-red 2s infinite;
        display: none; /* Hidden by default, shown via JS if data exists */
    }
    
    @keyframes pulse-red { 0% { opacity: 0.6; } 50% { opacity: 1; transform: scale(1.2); } 100% { opacity: 0.6; } }

    /* Wallet Styles */
    .wallet-container {
        position: relative;
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(16, 185, 129, 0.2));
        backdrop-filter: blur(20px);
        border: 1px solid rgba(251, 191, 36, 0.4);
        border-radius: 20px;
        padding: 8px 14px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        min-width: 80px;
        box-shadow: 
            0 8px 25px rgba(251, 191, 36, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .wallet-container:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 
            0 12px 35px rgba(251, 191, 36, 0.35),
            0 0 0 1px rgba(251, 191, 36, 0.5),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(16, 185, 129, 0.3));
    }

    .wallet-icon {
        width: 18px;
        height: 18px;
        filter: brightness(1.2) contrast(1.1);
        transition: filter 0.3s ease;
    }

    .wallet-container:hover .wallet-icon {
        filter: brightness(1.4) contrast(1.2) drop-shadow(0 1px 2px rgba(251, 191, 36, 0.5));
    }

    .wallet-amount {
        font-size: 13px;
        font-weight: 800;
        color: #fbbf24;
        letter-spacing: -0.01em;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* --- NOTIFICATION OVERLAY STYLES --- */
    .notif-overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(5, 7, 10, 0.6);
        backdrop-filter: blur(8px);
        z-index: 20000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        display: flex;
        justify-content: flex-end;
    }

    .notif-overlay.open {
        opacity: 1;
        pointer-events: auto;
    }

    .notif-panel {
        width: 100%;
        max-width: 360px;
        height: 100%;
        background: rgba(15, 23, 42, 0.95);
        border-left: 1px solid rgba(16, 185, 129, 0.2);
        box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        transform: translateX(100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        padding-top: var(--header-h); /* Clear header */
    }

    .notif-overlay.open .notif-panel {
        transform: translateX(0);
    }

    .notif-header {
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .notif-title {
        color: #fbbf24;
        font-weight: 700;
        font-size: 18px;
    }

    .close-notif {
        color: #94a3b8;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
    }

    .notif-list {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
    }

    /* Individual Notification Card */
    .notif-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 14px;
        margin-bottom: 12px;
        position: relative;
        transition: transform 0.2s;
    }
    
    .notif-card:hover {
        background: rgba(255, 255, 255, 0.06);
    }

    .notif-card::before {
        content: '';
        position: absolute;
        left: 0; top: 12px; bottom: 12px;
        width: 3px;
        background: #10b981;
        border-radius: 0 4px 4px 0;
        box-shadow: 2px 0 10px rgba(16, 185, 129, 0.3);
    }

    .n-title {
        color: #e2e8f0;
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
    }

    .n-body {
        color: #94a3b8;
        font-size: 12px;
        line-height: 1.4;
    }
    
    .n-time {
        display: block;
        text-align: right;
        font-size: 10px;
        color: #fbbf24;
        margin-top: 6px;
        opacity: 0.8;
    }

    /* --- LOADER --- */
    #router-loader {
        position: fixed;
        top: var(--header-h); 
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 500;
        background-color: var(--bg-dark);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: opacity 0.3s ease;
    }

    .energy-core { position: relative; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; }
    .core-outer { position: absolute; width: 100%; height: 100%; border: 2px solid transparent; border-left-color: #fbbf24; border-right-color: #fbbf24; border-radius: 50%; animation: core-rotate 1.2s infinite; }
    .core-inner { position: absolute; width: 70%; height: 70%; border: 2px solid transparent; border-top-color: var(--active-color); border-bottom-color: var(--active-color); border-radius: 50%; animation: core-rotate-rev 1s linear infinite; }
    @keyframes core-rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes core-rotate-rev { 0% { transform: rotate(360deg); } 100% { transform: rotate(0deg); } }

    /* --- CONTENT AREA --- */
    #app-outlet {
        width: 100%;
        flex: 1;
        padding-top: calc(var(--header-h) + 20px);
        padding-bottom: calc(var(--nav-h) + 50px);
        box-sizing: border-box;
    }

    /* --- FLOATING BOTTOM DOCK --- */
    .bottom-nav {
        position: fixed !important;
        bottom: 20px;
        left: 5%;
        right: 5%;
        width: 90%; 
        height: var(--nav-h);
        background: var(--nav-bg) !important;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        display: flex; 
        justify-content: space-around;
        align-items: center;
        border: 1px solid rgba(16, 185, 129, 0.2);
        z-index: 10000;
        border-radius: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 15px var(--emerald-glow);
    }

    /* --- NAV ITEMS --- */
    .nav-btn {
        position: relative;
        display: flex; 
        flex-direction: column; 
        align-items: center;
        justify-content: center;
        color: #94a3b8; 
        text-decoration: none; 
        font-size: 10px;
        font-weight: 600;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        background: transparent;
        border: none;
        width: 20%;
    }

    .nav-btn img { 
        width: 22px; 
        height: 22px; 
        margin-bottom: 4px; 
        transition: transform 0.3s ease;
        filter: invert(1) opacity(0.5); 
    }

    .nav-btn.active { 
        color: var(--active-color) !important;
        opacity: 1 !important;
    }

    .nav-btn.active img { 
        filter: invert(42%) sepia(93%) saturate(1352%) hue-rotate(120deg) brightness(100%) contrast(100%) !important;
        transform: translateY(-5px);
    }

    /* --- GOLDEN CENTER BUTTON (REFER) --- */
    .center-btn {
        background: var(--accent-grad) !important;
        width: 58px !important;
        height: 58px !important;
        border-radius: 50% !important;
        margin-top: -45px;
        border: 5px solid var(--bg-dark) !important;
        box-shadow: 0 5px 15px rgba(217, 119, 6, 0.4);
        opacity: 1 !important;
    }

    .center-btn img {
        filter: brightness(0) !important; 
        margin-bottom: 0;
        width: 26px;
        height: 26px;
    }
    
    .center-btn span {
        position: absolute;
        bottom: -22px;
        color: #fbbf24;
        font-weight: 800;
    }
  </style>
</head>

<body>

  <header>
    <div class="header-container">
      <div class="logo-section">
        <div class="profile-avatar">
          <img src="https://i.ibb.co/KpFsjM89/1771012106710.png" class="w-full h-full object-cover">
        </div>
        <h1 class="logo-text">FFTW</h1>
      </div>
      
      <div class="header-actions">
          <button class="notif-btn" id="notif-trigger">
              <span class="notif-dot" id="notif-badge"></span>
              <img src="https://cdn-icons-png.flaticon.com/512/3602/3602145.png" class="notif-icon">
          </button>

          <div id="walletDisplay" onclick="router.navigate('wallet')" class="wallet-container">
            <img src="https://i.postimg.cc/3R7QM12R/wallet-filled-money-tool.png" class="wallet-icon">
            <span id="nav-wallet-amount" class="wallet-amount">â‚¹0.00</span>
          </div>
      </div>
    </div>
  </header>

  <div id="router-loader">
      <div class="energy-core">
          <div class="core-outer"></div>
          <div class="core-inner"></div>
      </div>
      <p class="mt-6 text-[9px] font-bold tracking-[0.4em] text-emerald-500 uppercase animate-pulse">Synchronizing</p>
  </div>

  <main id="app-outlet">
      </main>

  <div id="notification-overlay" class="notif-overlay">
      <div class="notif-panel">
          <div class="notif-header">
              <span class="notif-title">Notifications</span>
              <button class="close-notif" id="close-notif">&times;</button>
          </div>
          <div class="notif-list" id="notif-list-container">
              <div style="text-align:center; padding: 20px; color: #64748b;">
                  Loading updates...
              </div>
          </div>
      </div>
  </div>

  <nav class="bottom-nav">
    <button data-route="home" onclick="router.navigate('home'); handleNavClick(this)" class="nav-btn active">
        <img src="https://cdn-icons-png.flaticon.com/512/1946/1946436.png">
        <span>Home</span>
    </button>

    <button data-route="mymatches" onclick="router.navigate('mymatches'); handleNavClick(this)" class="nav-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/13/13973.png">
        <span>Matches</span>
    </button>

    <button data-route="refer" onclick="router.navigate('refer'); handleNavClick(this)" class="nav-btn center-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/6537/6537740.png">
        <span>Refer</span>
    </button>

    <button data-route="profile" onclick="router.navigate('profile'); handleNavClick(this)" class="nav-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png">
        <span>Profile</span>
    </button>

    <button data-route="wallet" onclick="router.navigate('wallet'); handleNavClick(this)" class="nav-btn">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135706.png">
        <span>Wallet</span>
    </button>
  </nav>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // --- PASTE YOUR FIREBASE CONFIG HERE ---
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM Elements
    const notifBtn = document.getElementById('notif-trigger');
    const closeBtn = document.getElementById('close-notif');
    const overlay = document.getElementById('notification-overlay');
    const listContainer = document.getElementById('notif-list-container');
    const badge = document.getElementById('notif-badge');

    // Toggle Overlay
    function toggleOverlay(show) {
        if(show) {
            overlay.classList.add('open');
            fetchNotifications(); // Fetch data when opened
        } else {
            overlay.classList.remove('open');
        }
    }

    notifBtn.addEventListener('click', () => toggleOverlay(true));
    closeBtn.addEventListener('click', () => toggleOverlay(false));
    
    // Close on click outside panel
    overlay.addEventListener('click', (e) => {
        if(e.target === overlay) toggleOverlay(false);
    });

    // Fetch Logic
    async function fetchNotifications() {
        listContainer.innerHTML = '<div style="text-align:center; padding: 20px; color: #fbbf24;">Syncing...</div>';
        
        try {
            // Assuming 'createdAt' is the timestamp field in your collection
            // If you don't have a timestamp, remove: orderBy("createdAt", "desc")
            const q = query(collection(db, "notifications")); // Optionally add orderBy here
            const querySnapshot = await getDocs(q);
            
            listContainer.innerHTML = ''; // Clear loader

            if (querySnapshot.empty) {
                listContainer.innerHTML = '<div style="text-align:center; padding: 20px; color: #64748b;">No new notifications.</div>';
                return;
            }

            // Simple check to show badge if we have data (can be refined to unread status)
            badge.style.display = 'block';

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                
                // Fallback for missing fields
                const title = data.title || "Notification";
                const message = data.message || data.body || "No details available.";
                // Formatting timestamp if available (assumes Firestore Timestamp)
                let timeStr = "";
                if(data.timestamp || data.createdAt) {
                    const ts = data.timestamp || data.createdAt;
                    timeStr = new Date(ts.seconds * 1000).toLocaleDateString();
                }

                const cardHTML = `
                    <div class="notif-card">
                        <div class="n-title">${title}</div>
                        <div class="n-body">${message}</div>
                        ${timeStr ? `<span class="n-time">${timeStr}</span>` : ''}
                    </div>
                `;
                listContainer.innerHTML += cardHTML;
            });

        } catch (error) {
            console.error("Error fetching notifications:", error);
            listContainer.innerHTML = '<div style="text-align:center; color: #ef4444; padding: 20px;">Failed to load.</div>';
        }
    }
  </script>

  <script>
    function handleNavClick(clickedBtn) {
        if(!clickedBtn) return;
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        clickedBtn.classList.add('active');
    }

    window.addEventListener('load', () => {
        const hash = window.location.hash.replace('#', '') || 'home';
        const activeBtn = document.querySelector(`.nav-btn[data-route="${hash}"]`);
        if(activeBtn) handleNavClick(activeBtn);
        
        setTimeout(() => {
            const loader = document.getElementById('router-loader');
            if(loader) {
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 300);
            }
        }, 800);
    });
  </script>

  <script type="module" src="app-ui.js"></script>
</body>
</html>
