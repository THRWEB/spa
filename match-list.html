<style>
    #matchCard { 
      border-radius: 1.3rem; 
      border-left: 6px solid #10b981;
      background: linear-gradient(to bottom right, #1e293b, #0f172a);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    .es-value { font-weight: 800; color: #4ade80; }
    .match-title { text-shadow: 0 2px 12px #08080866; }
</style>

<main class="max-w-md mx-auto px-3 py-4">
    <h2 id="pageTitle" class="text-xl font-bold text-emerald-400 mb-6 uppercase text-center tracking-wider">Loading Matches...</h2>
    <div id="matchContainer" class="space-y-4"></div>
</main>

<script>
    (function() {
        // SPA-তে URL থেকে প্যারামিটার নেওয়ার একটু আলাদা সিস্টেম (যদি রাউটার সেটি পাস না করে)
        // আমরা আপাতত সরাসরি URL থেকেই নিচ্ছি
        const params = new URLSearchParams(window.location.search);
        let categoryId = params.get('cat');

        // যদি ক্যাটাগরি না থাকে, তবে আগের পেজ থেকে সেভ করা ক্যাটাগরি খোঁজা
        if(!categoryId) categoryId = window.currentCategory;

        const titles = {
            'soloc': 'Solo Classic', 'solocs': 'Solo Clash Squad',
            'duoc': 'Duo Classic', 'duocs': 'Duo Clash Squad',
            'squadc': 'Squad Classic', 'squadcs': 'Squad Clash Squad'
        };

        const pageTitle = document.getElementById('pageTitle');
        const container = document.getElementById('matchContainer');

        if (categoryId && titles[categoryId]) {
            pageTitle.innerText = titles[categoryId];
            
            const db = firebase.firestore();
            const q = db.collection("allMatches");

            // রিয়েল-টাইম ম্যাচ লিসেনার
            const unsubscribe = q.onSnapshot((snapshot) => {
                // যদি ইউজার পেজ থেকে চলে যায় তবে লিসেনার বন্ধ হবে
                if (!document.getElementById('matchContainer')) {
                    unsubscribe();
                    return;
                }

                container.innerHTML = ''; 
                let hasMatches = false;

                snapshot.forEach((doc) => {
                    const match = doc.data();
                    
                    if(match.category && match.category.toString().trim().toLowerCase() === categoryId.toLowerCase()) {
                        hasMatches = true;
                        const matchDisplayTime = window.formatMatchTime ? window.formatMatchTime(match.time) : "TBA";
                        
                        const card = `
                            <div id="matchCard" class="px-4 pt-3 pb-4 mb-4 relative overflow-hidden">
                                <div class="flex items-center gap-3">
                                    <img src="${match.image || 'https://i.postimg.cc/rsf7yB1M/1768308154801.jpg'}" 
                                         class="rounded-lg object-cover w-16 h-16 border-2 border-emerald-800 shadow" />
                                    <div class="match-title text-gray-100 text-lg font-bold mt-1">${match.title || 'Tournament'}</div>
                                </div>
                                
                                <div class="mt-4 space-y-1.5 text-sm">
                                    <div class="flex justify-between"><span>Entry Fee:</span><span class="es-value">₹${match.entry || 0}</span></div>
                                    <div class="flex justify-between"><span>Prize:</span><span class="es-value">₹${match.prize || 0}</span></div>
                                    <div class="flex justify-between"><span>Time:</span><span class="es-value">${matchDisplayTime}</span></div>
                                    <div class="flex justify-between"><span>Map:</span><span class="es-value">${match.map || 'Bermuda'}</span></div>
                                    <div class="flex justify-between"><span>Slots Left:</span><span class="es-value">${match.slot || 0}</span></div>
                                </div>

                                <button onclick="window.currentMatchId='${doc.id}'; router.navigate('match-details')" 
                                    class="mt-4 bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold py-3 rounded-xl w-full shadow-lg active:scale-95 uppercase text-sm">
                                    Match Details
                                </button>
                            </div>`;
                        container.innerHTML += card;
                    }
                });

                if (!hasMatches) {
                    container.innerHTML = `<p class="text-center text-gray-500 mt-20">No active matches for ${titles[categoryId]}</p>`;
                }
            });
        } else {
            pageTitle.innerText = "Category Not Found";
            container.innerHTML = `<button onclick="router.navigate('home')" class="w-full p-4 bg-emerald-500 rounded-xl">Go Back Home</button>`;
        }
    })();
</script>
